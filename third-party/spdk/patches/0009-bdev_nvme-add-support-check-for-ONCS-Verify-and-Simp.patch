From 6de1b469fb83d940c09d6bf6358b9878e72fd480 Mon Sep 17 00:00:00 2001
From: "Simon A. F. Lund" <simon.lund@samsung.com>
Date: Thu, 5 Nov 2020 15:39:00 +0100
Subject: [PATCH 9/9] bdev_nvme: add support-check for ONCS Verify and Simple
 Copy

Signed-off-by: Simon A. F. Lund <simon.lund@samsung.com>
Change-Id: Id317596458ea8cd1625d867be7c735470a6200d3
---
 module/bdev/nvme/bdev_nvme.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/module/bdev/nvme/bdev_nvme.c b/module/bdev/nvme/bdev_nvme.c
index d8027d15a..4f04de7e4 100644
--- a/module/bdev/nvme/bdev_nvme.c
+++ b/module/bdev/nvme/bdev_nvme.c
@@ -857,21 +857,21 @@ bdev_nvme_io_type_supported(void *ctx, enum spdk_bdev_io_type io_type)
 	case SPDK_BDEV_IO_TYPE_COMPARE_AND_WRITE:
 		if (spdk_nvme_ctrlr_get_flags(ctrlr) &
 		    SPDK_NVME_CTRLR_COMPARE_AND_WRITE_SUPPORTED) {
 			return true;
 		}
 		return false;
 
 	case SPDK_BDEV_IO_TYPE_VERIFY:
-		cdata = spdk_nvme_ctrlr_get_data(nbdev->nvme_bdev_ctrlr->ctrlr);
+		cdata = spdk_nvme_ctrlr_get_data(ctrlr);
 		return cdata->oncs.verify;
 
 	case SPDK_BDEV_IO_TYPE_SIMPLE_COPY:
-		cdata = spdk_nvme_ctrlr_get_data(nbdev->nvme_bdev_ctrlr->ctrlr);
+		cdata = spdk_nvme_ctrlr_get_data(ctrlr);
 		return cdata->oncs.copy;
 
 	default:
 		return false;
 	}
 }
 
 static int
-- 
2.20.1

